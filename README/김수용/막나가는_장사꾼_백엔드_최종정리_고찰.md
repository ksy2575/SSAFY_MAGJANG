## 막나가는 장사꾼

---

### 백엔드 최종 정리 - 고찰

[TOC]

### 설계

1. 프로젝트 기간 예측 실패
   - 팀원 6명 모두 프로젝트 경험이 부족하여 정확한 기간 예측을 하지 못했다. 구현 막바지 단계에 다다르며 프로젝트 설계 단계의 중요성을 다시 한 번 깨달을 수 있었다.
2. 계층화 구조를 제대로 지키지 못함
   - 계층화 구조(Layered Architecture)의 컨트롤러 - 서비스 - 레포지토리 구조를 제대로 활용하지 못했다. 컨트롤러가 로직을 직접 수행하는 것이 아니라 서비스에게 파라미터를 넘기며 요청하는 구조로 처리해야 더 올바른 구조라고 할 수 있다.
   - 22.04.10 - 리팩토링 중
4. 스프링 IoC / DI의 부적절한 활용
   - 서비스, 레포지토리 등을 인터페이스로 구현하지 않고 처리했다. 코드 작성 시간은 줄었지만, 클래스간 결합도가 높아져 확장에 열려있는 구조가 아니게 되었다. 자유 프로젝트 기간에 새 기능을 추가하는 등 코드를 수정하고 싶은 마음이 있기 때문에, 이는 좋은 설계가 아니라고 볼 수 있다.

### 코드

1. stomp 귓속말 구현 방법
   - stomp를 활용한 귓속말을 구현할 때 웹 소켓 세션 주체의 정보를 담고 있는 java.security.principal 객체를 통한 사용자 구별을 구현하지 못했던 것이 아쉽다. 본 프로젝트에서는 사용자를 닉네임으로 구별할 수 있었기 때문에 큰 문제는 없었으나, 나중에 제대로 convertAndSendToUser() 메서드를 사용하기 위해 관련 정보를 찾아보았다.
   - 관련 외부 자료 : [Principal - docs.oracle.com](https://docs.oracle.com/javase/8/docs/api/java/security/Principal.html), [STOMP - convertAndSendToUser 사용법](https://withseungryu.tistory.com/136)
2. Redis 캐시 서비스
   - 현재 버전의 프로젝트에서는, 생성된 게임방을 관리하는 GameMap이 서버가 꺼지기 전까지 계속해서 GameDTO 인스턴스를 참조하게 된다. 이는 실제 서비스 시 불필요한 메모리를 대량으로 떠안게 되므로 좋은 구현 방식이 아니다. 가능하다면 특정 이벤트 때 GameDTO를 삭제하거나, LRU(Least Recently Used) 설정이 가능한 Redis 캐시 시스템을 활용하여 서버의 효율을 증대시킬 수 있을 것이다. 이에 관련한 발표 자료를 활용하며 구현하면 좋을 것이다.
   - 웹 어플리케이션 캐시 적용 : [김수용_발표자료.pdf](assets/대전_2반_김수용_공유데이_발표자료.pdf), [김수용_발표자료.pptx](assets/대전_2반_김수용_공유데이_발표자료.pptx)
3. JUnit을 활용한 테스트
   - 프로젝트를 구현하며 단위 테스트를 거의 진행하지 않았다. 게임 서비스라는 특성에 따라 가장 처음 부분부터 잘 작동하는지 여부를 중심으로 확인하며 진행하였는데, 이는 시간을 크게 잡아먹는 작업이었다. given-when-then 패턴에 따라 각 메서드를 검증했다면 더 효율적인 코딩을 할 수 있었을 것이다.
   - 관련 외부 자료 : [JUnit을 활용한 Java 단위 테스트 코드 작성법](https://mangkyu.tistory.com/143)
4. 쓰레드 활용
   - Spring에서의 비동기 처리를 위해 @Async 어노테이션을 활용하였다. MaxPoolSize = 100으로 두어 여러 게임방이 서비스 중인 상태에도 문제 없이 요청을 처리할 수 있도록 구현하였다. 이때, 순차적으로 실행되어야 하는 메서드마다 roomId를 파라미터로 필요로 하기 때문에 ListenableFuture 인터페이스를 구현한 AsyncResult 클래스를 반환하도록 하였다.
   - 관련 외부 자료 : [SPRING @Async를 활용한 multi thread 구현](https://cofs.tistory.com/318)

5. 코드 스멜 분석 결과 - 보안 문제

### 소감

1. Git 브랜치 규정
   - Git 브랜치를 용도에 맞게 잘 활용하고 싶었으나, SSAFY의 프로젝트 심사 규정 상 매 주 master 브랜치에 모든 변경 사항을 머지해야 했던 점이 아쉬웠다. 그래도 혼자 공부했던 Git 협업 방법론을 공유하며 함께 활용할 수 있어서 좋은 경험이었다. 처음 Git을 마주했을 때 패닉이 됐었던 기억이 있어, 팀원들의 Git 관련한 많은 의문을 함께 해결해주고 공부하고자 하였다.

2. 경매, 아이템, 랭킹 기능 삭제
   - 설계 시 고려했던 우선순위에 따라 위 추가 기능들은 가장 마지막에 구현하기로 하였다. 시간이 많지 않아 삭제할 수 밖에 없었지만 추후에 다시 작업할 기회가 있었으면 좋겠다.
3. 다함께 FE 구현에 집중했던 이야기
   - 종료 5일 전, 초기 설계했던 백엔드 API 구현을 완료하였다. 남은 기간 동안 위의 convertAndSendToUser() 구현, Redis 캐시 서비스 활용, JUnit 테스트 등을 진행했으면 좋았겠지만, 생각보다 프론트엔드 컴포넌트 구조 설계와 API 구현에 어려움을 많이 겪고 있어 전 팀원이 이를 해결하기 위해 붙게 되었다. 덕분에 본 프로젝트의 전체적인 구조와 vue3, 자바스크립트 문법 등의 개념을 공부할 수 있었지만 아쉬움이 남는다.
